# 4장 자바 프로젝트 빌드

## 4.1 자바 프로젝트에 왜 플러그인이 필요할까

```groovy
apply plugin: "java"
```

gradle의 핵심 기능은 다음 두 가지로만 구성되어 있다.

- 전형적인 반복 작업을 자동화하기 위한 구조
- 자동화된 처리를 실행하기 위한 부품

대표 기능인 빌드도 예외가 아니다. 자동화 대상이 되는 구체적인 작업들을 모드 플러그인으로 구현되어 있으며, 핵심 기능과 분리되어 있다. 엄밀히 말하면, gradle은 빌드 툴이 아니라 확장 가능한 자동화 툴이라 부르는 것이 적절할 수도 있다.

자바 프로젝트 빌드에 Java 플러그인이 필요한 이유는 그레이들의 아키텍처에서 비롯된 것이다.

## 4.2 Java 플러그인이란

Java 플러그인은 자바 빌드에 필요한 ‘태스크', 설정을 단순화하는 ‘규칙' 그리고 그것을 구현하기 위한 ‘속성' 및 ‘소스 세트'가 패키지로 구성된 빌드 기능 컴포넌트다. 4가지 주요 요소를 하나씩 살펴보자.

### 4.2.1 소스 세트(SourceSet)

자바 프로젝트 빌드에서는 한 프로젝트에 목적이 다른 자바 코드나 리소스가 섞여 있을 때가 종종 있다. 예를 들어 빌드 대상이 되는 프로덕션 코드와 이를 테스트하기 위한 테스트 코드가 있고, 테스트 코드는 다시 단위 테스트와 통합 테스트로 나뉘어 구성된다.

gradle의 java 플러그인은 이런 구성에 대응하기 위해 소스 세트라는 구조를 제공한다.

소스 세트는 동시에 컴파일해야 할 자바 코드와 리소스를 논리적으로 그룹화한 개념으로 다음과 같은 특징이 있다.

- 빌드 스크립트에 자유롭게 추가할 수 있다.
- 고유한 이름이 있다.
- 컴파일 입력 대상인 자바 코드와 리소스를 세트로 지정할 수 있다.
- 컴파일 출력(클래스 파일 등) 경로를 지정할 수 있다.
- 컴파일 시 클래스패스나 실행 시 클래스패스를 지정할 수 있다.
- 소스 세트 단위로 전용 태스크를 제공한다.
- 소스 세트 단위로 전용 속성을 제공한다.

소스 세트를 이용하면 태스크 의존관계를 제어하기 편리하다. 예를 들어 테스트 코드를 컴파일하기 전에 프로덕션 코드를 컴파일해야 할 때 테스트 코드에 해당하는 소스 세트의 컴파일 태스크 의존관계에 프로덕션 코드 컴파일 태스크를 설정만 하면 된다.

### 4.2.2 태스크(task)

일반적으로 자바를 빌드할 때는 여러 가지 작업이 필요하다. 대충 나열해보면 다음과 같다.

- 코드 파일 컴파일
- 테스트
- Javadoc 생성
- JAR 파일로 압축

gradle의 Java 플러그인에는 이 모든 작업이 태스크로 정의되어 있으며, 명령줄에서 원하는 태스크를 지정해서 실행할 수 있다. Java 플러그인에서 제공하는 태스크 목록은 아래 표에서 확인할 수 있다.

**!!!공식 문서 확인할 것!!**

[https://docs.gradle.org/current/userguide/java_plugin.html#sec:java_tasks](https://docs.gradle.org/current/userguide/java_plugin.html#sec:java_tasks)
책에서 uploadArchives 가 나와있는데 현재는 uploadConfigName으로 바뀐 거 같아서 수정했다. 나머지는 그대로 인 듯.

| 태스크 | 설명 |
| --- | --- |
| compileJava | 프로덕션 코드를 컴파일.(컴파일 대상은 소스 세트 main의 java.srcDirs 속성에서 지정한 디렉토리에 있는 코드 중 .java인 파일이다) |
| processResources | 프로덕션 코드의 리소스를 클래스패스에 복사한다. 복사 대상은 소스 세트 main의 resources.srcDirs 속성에서 지정한 디렉터리에 있는 파일 중 확장자가 .java인 것을 제외한 모든 파일이다. |
| classes | compileJava 태스크와 processResources 태스크를 실행한다. |
| compileTestJava | 테스트 코드를 컴파일한다. 컴파일 대상은 소스 세트 test의 java.srcDirs에서 지정한 디렉터리에 있는 파일 중 확장자가 .java인 파일이다. |
| processTestResources | 테스트 코드를 컴파일한다. 컴파일 대상은 소스 세트 test의 java.srcDirs에서 지정한 디렉터리에 있는 파일 중 확장자가 .java인 파일이다. |
| testClasses | compileTestJava 태스크와 processTestResources 태스크를 실행한다. |
| jar | JAR 파일을 생성한다. 기본 압축 대상은 소스 세트 main의 output 속성. 즉 compileJava 태스크와 processResources 태스크를 출력한 결과다. |
| javadoc | 프로덕션 코드(소스 세트 main)의 Javadoc을 생성한다. |
| test | 테스트 코드(소스 세트 test)에 포함된 테스트를 실행한다. 기본 테스트 대상은 testClasses 태스크의 출력 결과에 자동으로 추출된다. |
| uploadConfigName | 결과물의 압축(JAR 파일 등) 파일을 저장소에 업로드한다. |
| clean | 빌드 출력 결과를 삭제한다. 기본 설정에서는 build 디렉터리가 삭제된다. |
| clean(TaskName) | 태스크 <TaskName>의 출력 결과만 삭제한다.(예: cleanJavadoc) |
| assemble | 테스트를 실행하지 않고 결과물(JAR 파일)만 생성한다. Java 플러그인의 기본 설정에서는 jar 태스크와 같다. 빌드 스크립트로 결과물이나 별도의 플러그인을 추가하면 동작이 바뀔 수도 있다. 프로젝트 내용에 따라 적절한 결과물을 생성한다고 이해하면 된다. |
| check | 프로젝트를 검사한다. Java 플러그인의 기본 설정에서는 test 태스크와 같다. 다른 플러그인을 추가하면 의존 태스크가 추가될 수도 있다. 프로젝트 내용에 따라 테스트 코드나 정적 코드를 조사한다고 이해하면 된다. |
| build | 프로젝트를 빌드한다. 구체적으로 check 태스크와 assemble 태스크를 실행한다. |
| buildNeeded | 빌드 대상 프로젝트와 프로젝트 의존관계에서 지정한 의존 대상 프로젝트도 함께 빌드한다. |
| buildDependents | 빌드 대상 프로젝트에 의존하는 프로젝트도 함께 빌드한다. |

소스세트를 추가하면 소스 세트 단위로 태스크가 자동으로 추가된다. 예시로 foo라는 소스 세트가 추가되면 아래의 태스크가 추가된다.

- compileFooJava
- processFooResources
- fooClasses

### 4.2.3 규칙(rule)

규칙 또한 Java 플러그인에 포함되어 있다. 규칙은 ‘자바 파일은 src/main/java 아래에 둔다'와 같이 그걸 전제로 Java 플러그인이 해당 디렉터리를 대상으로 처리를 하는 것이다. 미리 정해진 규칙을 지켜 정해진 작성법을 배제하고 최소한의 내용만으로 빌드 스크립트를 작성하자는 의미다.

Java 플러그인에는 다음과 같은 규칙이 있다.

- 프로덕션 코드 파일은 src/main/java 디렉터리 아래에 둘 것
- 프로덕션 리소스 파일은 src/main/resources 디렉터리 아래에 둘 것
- 테스트 코드 파일은 src/test/java 디렉터리 아래에 둘 것
- 테스트 리소스 파일은 src/test/resources 디렉터리 아래에 둘 것

메이븐 규칙과 비슷하다.

### 4.2.4 속성(property)

Java 플러그인은 앞서 본 태스크를 제어하거나 규칙을 구현하기 위해 필요한 속성을 제공한다. 대부분의 속성에는 초기값이 설정되어 있어 그래이들 규칙을 따르는 한 변경하지 않고 그대로 사용하면 된다. 그래이들 규칙에서 벗어난 환경에서는 필요에 따라 속성 값을 변경해서 커스터마이징할 수 있다.

프로퍼티가 너무 많고 책과 현재 내용이 다룰 수 있으니 그냥 그래이들 공식 홈페이지를 찾아왔다. 

[https://docs.gradle.org/current/userguide/java_plugin.html#directory_properties](https://docs.gradle.org/current/userguide/java_plugin.html#directory_properties)

지금 보니 그래이들에서 책에 나오는 프로퍼티들이 deprecated 됐다고 적혀 있네! 이 부분은 공식 문서 확인하는게 더 낫겠다.

*Note: This class is [deprecated](https://docs.gradle.org/current/userguide/feature_lifecycle.html) and will be removed in the next major version of Gradle.*