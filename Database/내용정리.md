
# 데이터베이스 설계와 구축 성능까지 고려한 데이터 모델링
이춘식 님의 데이터베이스 설계와 구축 성능까지 고려한 데이터 모델링 책을 학습하고 정리한 내용입니다.

1. 엔티티타입: 유용한 정보를 영속화하는 단위
    
    유일 식별자, 1개 이상 속성, 1개 이상 관계
    
    분류 - 유형(성격): 유형/개념/사건 엔티티타입, - 발생기점(업무): 기본/중심/행위 엔티티타입 
    
    명명: 단수 명사/약어 자제/현업 용어/유일
    
2. 관계: 엔티티타입 간의 논리적 관계, 영향을 어떻게 주고 받는지 표시
    
    존재(소속한다) vs 행위(주문한다)
    
    관계 페어링(paring): 엔티티와 엔티티 사이 관계가 설정된 어커런스
    
    명명 - 2개의 멤버쉽(소속되다, 포함하다), 애매한 동사형 지양, 현재형
    
    관계 카디낼리티: 관계의 참여자 수,  1:1, 1:M, M:N
    
    선택 참여(O), 필수 참여
    
    관계의 종류 - 정상, 식별자-비식별자, 자기참조, 병렬관계, 슈퍼타입 서브타입(배타적, 참여적)
    
3. ERD: 엔티티타입과 관계를 설정해 데이터의 흐름, 프로세스 흐름을 파악하기 쉽게 하는 표기법
    1. 엔티티타입 그리기 → 적절히 배치 → 관계를 설정 → 관계명 기술 → 참여도 기술 → 참여여부
    
4. 정규화
    1. 1차 정규화: 속성에 단일 원자값을 갖게함
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f5ba4bbb-18ce-4ac0-96a7-76771d486c15/Untitled.png)
        
    2. 2차 정규화: 부분 함수 종속성 제거
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9c359843-8976-4b46-8dd9-3d3ab84e4f65/Untitled.png)
        
    3. 3차 정규화: 이행 함수 종속성 제거
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/44b4d6ed-98f1-4c4a-9d96-cd83fffb4098/Untitled.png)
        
    4. BCNF: 식별자 중복 제거
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/57d3b57d-df5d-4fc5-a576-8e44587a5d98/Untitled.png)
        
    5. 4차 정규화: 다가 속성 종속성 제거
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/66ff0aa0-fc21-4a4d-b29c-e722deb25f67/Untitled.png)
        
    
5. 데이터모델링 - 엔티티타입 정의
    1. 업무기술서, 장표, 인터뷰 정리 등에서 명사 추출
    2. 불분명한 것, 포괄적인 것 제거
    3. 엔티티타입의 특성, 속성에 관한 것 제거
    4. 포괄적인 프로세스에 관한 명사 제거
    5. 중복 명사 제거
    6. 누락된 것 유추
    
6. 관계 정의
    1. 업무기술서, 장표, 인터뷰 정리 등에서 동사 추출
    2. 도출된 엔티티타입과 관계를 이용해 관계정의서 작성
    3. 고객과 회의, 협의 ...
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2f12a0dd-3445-4d39-a464-5e65fd084869/Untitled.png)
    

1. 도메인 정의
    
    도메인: 엔티티타입 내 속성의 데이터타입, 크기, 제약 사항을 지정하는 것을 말한다. 도메인을 일정 규칙에 따라 정의하는 걸 도메인 정의라 한다. 
    
    도메인을 이용하면 모델 관리가 용이하고, 에러 발생 확률이 감소한다.
    
    정의 방법
    
    1. 코드에 대한 도메인
    2. 일련번호
    3. **일반적인 방법 - 모든 속성 나열 → 뒤에서 2~4자 분리 → 공통 발생 접미어 분리 → 비슷한 것끼리 묶어 이름 부여 → 데이터 타입, 길이 지정 → 속성에 도메인 할당**

1. CRUD MATRIX - 상관 모델링
    
    2개의 1차원 집합을 2차원 테이블로 비교. 엔티티타입과 단위 프로세스 등
    
    단위 프로세스가 엔티티타입에 어떤 일을 하는지 CRUD로 기술
    
    - 엔티티타입에 1개 이상의 CRUD가 있는지?
    - 엔티티타입에 1개 이상의 C or R이 있는지?
    - 단위 프로세스가 1개 이상의 엔티티타입과 관계가 있는지?
    - 한 엔티티타입에 2개 이상의 C가 있다면 재검토할 것
    
    장점
    
    - 데이터 모델, 프로세스 모델 검증
    - **주요 산출물**
    - 테스트에 도움
    - 전체 인터페이스 파악에 용이
    - **사전/사후 조건 제공**
    
2. 속성 검토
    
    속성: 엔티티타입 내 관리해야 하는 정보의 항목
    
    장표 등에서 도출되어 정규화를 거쳐 중복되지 않게 존재하고 있는 상태
    
    **고려 사항**
    
    - 반정규화된 내용이 식별되는지?
        
        반정규화: 검색 시 DB 성능의 개선을 위해 실시(조인을 피함)
        
        반정규화된 속성은 ERD에 2개 이상 발견된다. 
        
        다만, 이름만 같고 실제 속성이 같지 않는 경우 수정 필요
        
    - **반정규화가 시스템 복잡도, 성능을 고려했는지?**
        
        반정규화의 단점: 수정 시 부하(수정이 적은 경우에 적용), 데이터 무결성 깨질 수 있음
        
        데이터가 많은 데이터 웨어하우징이라면 반정규화를 적극 검토
        
    - **명칭이 같은 속성의 타입과 크기가 동일한지?**
        
        무결성 깨짐, 인덱스 조회 실패
        
    - 내부적인 속성을 갖는 속성은 없는지? ex) 성명(성+이름)
    - 병합될 속성은 없는지? ex) 날짜(연+월+일)
    - 전후 레코드간 영향을 미칠 속성은 없는지?
    - 감사, 통계 등을 고려했는지? ex) 코드화 될 수 있는지

1. 무결성 제약 정의
    
    데이터베이스에서는 데이터 정합성 유지를 위해 참조 무결성 제약을 적용함
    
    너무 많이 적용하면 오히려 성능이 떨어지니 주의해야 하며, FK 제약이 걸린 컬럼은 인덱스 생성을 권유한다. → 안그럼 풀스캔이 발생할 가능성이 커짐
    
    1. 입력 참조 무결성 - 입력될 때 PK에 대해 정합성을 일치시킴
        1. 의존: 참조하는 테이블의 PK가 존재해야만 입력 가능
        2. 자동: PK 없어도 알아서 생성해주고 입력됨
        3. 기본: 참조하는 테이블의 PK를 기본값으로 바꾸고 입력
        4. 지정: 사용자가 정의한 조건 만족 시 입력
        5. Null, 미지정: 참조하는 테이블의 PK가 없어도 입력하고 PK 컬럼값이 Null
    2. 수정 참조 무결성 - 자신의 PK가 수정되면 관련된 모든 테이블의 FK도 수정
        1. 제한: 자기 PK 수정할 때, 자기를 참조하는 FK가 없어야함(있으면 수정 X)
        2. 연쇄: 자기 PK 수정하면 참조되는 모든 FK 수정하고 자신의 PK도 수정
    3. 삭제 참조 무결성: 자신의 PK 삭제될 때 관련 **모든 FK를 기본값이나 Null로 수정해** 데이터 정합성 유지
        1. 제한: 자기 테이블 레코드 삭제 시, 참조하는 레코드가 없어야 한다.
        2. 연쇄: 자기 테이블 레코드 삭제 시 참조하는 레코드를 먼저 삭제하고 그 다음 삭제
        3. 기본: 참조하는 테이블의 레코드를 기본값으로 바꾸고 삭제
        4. 지정: 사용자가 정의한 조건을 만족 시 삭제
        5. Null: 참조하는 테이블의 레코드를 Null로 바꾸고 삭제
        6. 미지정: 조건 없이 삭제 가능
    
2. 트랜잭션
    1. DB에 행해지는 작업의 단위를 트랜잭션이라 한다.
    2. 분석 - 단위 프로세스, CRUD MATRIX 이용해 트랜잭션 분석서 작성
    3. 단위 프로세스 도출 → 상관모델링으로 CRUD MATRIX 작성 → 트랜잭션 분석도
    4. 트랜잭션 분석도: 용량 산정 근거, **디스크 구성에 이용**, DB와 연결되는 채널 분산에 도움 

1. 뷰 설계
    
    뷰는 실제 테이블을 바탕으로 만든 가상 테이블로 DB 오브젝트다. 별도 저장공간은 없어 값이 저장되진 않으나 조회가 가능하다. 
    
    특징
    
    - 테이블 구조 단순화
    - 다양한 관점의 데이터, 보안 유지 → 원하는 컬럼만 추출
    - 논리적인 데이터 독립성 유지
    - select에는 제한이 없으나 update 등에는 있음
    - 인덱스, 클러스터링을 지정할 수 없음
    
    대상
    
    - 외부 시스템과 인터페이스에 관여하는 테이블
    - 자주 조인되는 테이블
    - 인라인 뷰 방식으로 자주 접근되는 테이블

1. 비트맵 인덱스
    
    컬럼 정보를 0과 1을 이용해 별도 인덱스로 저장한다. WHERE 조건의 AND나 OR 연산으로 데이터를 검색한다.
    
    비트리 - OLTP, 필요 인덱스만 읽고, 소량 데이터 검색에 유리, 인덱스 크기 **크고**, 필요 스토리지 요구량 **크고**, C U D 쉬움
    
    비트맵 - DSS, 항상 전체 인덱스를 읽고, 대량 데이터 검색에 유리, 인덱스 크기 **작고**, 필요 스토리지 요구량 **작고**, C U D  힘듬(거의 재생성)
    
    ![http://wiki.gurubee.net/download/attachments/13893651/btree_btmap.png](http://wiki.gurubee.net/download/attachments/13893651/btree_btmap.png)
    
2. DB 생성
    - 일일이 스크립트에 지정해 생성
    - ODCA(Oracle Database Configuration Assitants)라는 그래픽 툴을 이용

1. DML, DDL

[DML, DDL](https://www.notion.so/DML-DDL-9c2c9d2233f848ea89d5730427d556c4)

뷰 생성 SQL

```sql
CREATE VIEW V_주문목록(주문번호, 신청자명, 주문일자, 제품번호, 단가) AS 
	SELECT A.주문번호, A.신청자명, A.주문일자, B.제품번호, B.단가
	FROM 주문 A, 주문목록 B
	WHERE A.주문번호 = B.주문번호;
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f6cc4a30-879e-4c90-9379-22636b024a71/Untitled.png)